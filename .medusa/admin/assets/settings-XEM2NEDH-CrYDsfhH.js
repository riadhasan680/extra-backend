import{K as V}from"./chunk-6HTZNHPT-DWUk5soK.js";import{R as w}from"./chunk-WVA4O7QS-B2aCntuO.js";import{u as H}from"./chunk-D6UW7URG-D6D77Ltf.js";import{r as f,j as s,H as q,bj as U,b as B,aC as W,aD as Z,t as C,I,B as _,ax as G,aI as J,az as Q,K as X,ak as M,_ as O,c7 as Y,a0 as F,bZ as ee,aS as se,a2 as te,a3 as le}from"./index-D2YvuHvs.js";import{u as ae,b as re}from"./chunk-FAB3VINY-Cz8TvMmt.js";var ne=Object.defineProperty,$=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,R=(t,e,l)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l,ce=(t,e)=>{for(var l in e||(e={}))P.call(e,l)&&R(t,l,e[l]);if($)for(var l of $(e))L.call(e,l)&&R(t,l,e[l]);return t},ie=(t,e)=>{var l={};for(var c in t)P.call(t,c)&&e.indexOf(c)<0&&(l[c]=t[c]);if(t!=null&&$)for(var c of $(t))e.indexOf(c)<0&&L.call(t,c)&&(l[c]=t[c]);return l};const D=f.forwardRef((t,e)=>{var l=t,{color:c="currentColor"}=l,o=ie(l,["color"]);return f.createElement("svg",ce({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:e},o),f.createElement("path",{stroke:c,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m10 12 2-2 2 2M14 3l-2 2-2-2M1 12h6M1 3h6M1 7.5h6"}))});D.displayName="Collapse";var k=({leftElement:t,expandButton:e,checked:l,onCheckedChange:c,label:o,className:u})=>{const h=l!==!1;return s.jsxs("div",{className:F("flex items-center gap-x-2 px-2 py-1.5",u),children:[t,s.jsx(te,{checked:l,onCheckedChange:c}),e,s.jsx(le,{size:"small",weight:h?"plus":"regular",className:"text-ui-fg-base",children:o})]})},K=ee.forwardRef(({entities:t,onSelectionChange:e,searchQuery:l,viewMode:c,sortOrder:o},u)=>{const[h,g]=f.useState(new Set),[v,p]=f.useState(new Set);f.useEffect(()=>{const a=new Set;t.forEach(d=>{var n;(n=d.fields)==null||n.forEach(i=>{i.selected&&a.add(`${d.id}.${i.id}`)})}),p(a)},[t]);const x=a=>{g(d=>{const n=new Set(d);return n.has(a)?n.delete(a):n.add(a),n})},b=a=>{var n;if(!((n=a.fields)!=null&&n.length))return!1;const d=a.fields.filter(i=>v.has(`${a.id}.${i.id}`)).length;return d===0?!1:d===a.fields.length?!0:"indeterminate"},E=a=>{p(d=>{var m;const n=new Set(d),r=b(a)===!0;return(m=a.fields)==null||m.forEach(j=>{const y=`${a.id}.${j.id}`;r?n.delete(y):n.add(y)}),e==null||e(n),n})},N=(a,d)=>{p(n=>{const i=new Set(n),r=`${a}.${d}`;return i.has(r)?i.delete(r):i.add(r),e==null||e(i),i})},S=a=>{if(a){const d=new Set;t.forEach(n=>{var i;(i=n.fields)==null||i.forEach(r=>{d.add(`${n.id}.${r.id}`)})}),p(d),e==null||e(d)}else p(new Set),e==null||e(new Set)},T=()=>g(new Set);f.useImperativeHandle(u,()=>({selectAllToggle:S,collapseAll:T}));const A=f.useMemo(()=>{let a=t;if(l){const n=l.toLowerCase();a=t.filter(i=>{var j;const r=i.name.toLowerCase().includes(n),m=(j=i.fields)==null?void 0:j.some(y=>y.name.toLowerCase().includes(n));return r||m})}return c==="selected"&&(a=a.filter(n=>b(n)!==!1)),[...a].sort((n,i)=>{const r=n.name.localeCompare(i.name);return o==="asc"?r:-r})},[t,l,c,o,v]);return s.jsx("div",{className:"flex h-full flex-col",children:s.jsx("div",{className:"flex-1 overflow-y-auto",children:A.length===0?s.jsx("div",{className:"text-ui-fg-subtle flex items-center justify-center py-12 text-sm",children:"No entities matching filters"}):s.jsx("div",{children:A.map(a=>{const d=h.has(a.id),n=a.fields&&a.fields.length>0,i=b(a);return s.jsxs("div",{children:[s.jsx(k,{checked:i,onCheckedChange:()=>E(a),label:a.name,className:"hover:bg-ui-bg-component-hover",expandButton:n?s.jsx("button",{type:"button",onClick:()=>x(a.id),className:"flex h-5 w-5 items-center justify-center",children:s.jsx(se,{className:F("text-ui-fg-muted transition-transform",d&&"rotate-90")})}):null}),n&&d&&s.jsxs("div",{className:"relative",children:[s.jsx(I,{orientation:"vertical",className:"absolute bottom-0 left-[2.87rem] top-0 z-10"}),a.fields.map(r=>{const m=`${a.id}.${r.id}`,j=v.has(m);return s.jsx(k,{className:"pl-3",leftElement:s.jsx("div",{className:"w-11"}),checked:j,onCheckedChange:()=>{N(a.id,r.id)},label:r.name},r.id)})]})]},a.id)})})})})});K.displayName="EntitySelectorTree";var oe=({value:t,onValueChange:e,options:l,className:c})=>s.jsx("div",{className:F("bg-ui-bg-disabled grid items-center gap-x-[1px] rounded-md p-[1px]",c),style:{gridTemplateColumns:`repeat(${l.length}, 1fr)`},children:l.map(o=>{const u=t===o.value;return s.jsx(_,{size:"small",onClick:()=>e(o.value),variant:u?"secondary":"transparent",type:"button",className:F("w-auto",!u&&"hover:text-ui-fg-base text-ui-fg-muted"),children:o.label},o.value)})}),de=({searchQuery:t,onSearchChange:e,viewMode:l,onViewModeChange:c,onSelectAllToggle:o,initialAllSelected:u,onSortToggle:h,sortOrder:g,onCollapseAll:v,className:p})=>{const{t:x}=B(),[b,E]=f.useState(u),N=()=>{E(S=>!S),o(!b)};return s.jsxs("div",{className:F("flex items-center gap-x-2",p),children:[s.jsx("div",{className:"flex-1",children:s.jsx(X,{size:"small",type:"search",placeholder:x("general.search"),value:t,onChange:S=>e(S.target.value),className:"w-full"})}),s.jsx(oe,{value:l,onValueChange:S=>c(S),options:[{value:"full",label:x("general.fullList")},{value:"selected",label:x("general.selected")}]}),s.jsx(_,{onClick:N,size:"small",variant:"secondary",type:"button",className:"min-w-[90px] whitespace-nowrap",children:x(b?"general.unselectAll":"general.selectAll")}),s.jsx(M,{content:x(g==="desc"?"filters.sorting.alphabeticallyAsc":"filters.sorting.alphabeticallyDesc"),children:s.jsx(O,{size:"small",onClick:h,type:"button",children:s.jsx(Y,{})})}),s.jsx(M,{content:x("filters.collapse.all"),children:s.jsx(O,{size:"small",onClick:v,type:"button",children:s.jsx(D,{})})})]})},ue=G({selectedFields:J(Q())}),z=t=>t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),fe=t=>Object.entries(t).map(([e,l])=>{const o=[...new Set([...l.fields,...l.inactive_fields])].map(u=>({id:u,name:z(u),selected:l.fields.includes(u)}));return{id:e,name:z(e),fields:o.length>0?o:void 0,selected:l.is_active}}),me=(t,e)=>{const l=[],c=[],o=new Map;return t.forEach(u=>{const[h,g]=u.split(".",2);o.has(h)||o.set(h,new Set),o.get(h).add(g)}),Object.entries(e).forEach(([u,h])=>{const g=o.get(u)||new Set,v=Array.from(g),p=g.size>0;!!h.id?c.push({id:h.id,fields:v,is_active:!!p}):p&&l.push({entity_type:u,fields:v})}),{create:l.length>0?l:void 0,update:c.length>0?c:void 0}},he=({translation_settings:t})=>{const{t:e}=B(),{handleSuccess:l}=H(),[c,o]=f.useState(""),[u,h]=f.useState("full"),[g,v]=f.useState("asc"),p=f.useRef(null),{mutateAsync:x,isPending:b}=re(),E=f.useMemo(()=>t?fe(t):[],[t]),N=f.useMemo(()=>{if(!t)return[];const r=[];return Object.entries(t).forEach(([m,j])=>{j.fields.forEach(y=>{r.push(`${m}.${y}`)})}),r},[t]),S=f.useMemo(()=>E.filter(r=>!r.selected),[E]),T=W({defaultValues:{selectedFields:N},resolver:Z(ue)}),A=r=>{T.setValue("selectedFields",Array.from(r),{shouldDirty:!0})},a=r=>{var m;(m=p.current)==null||m.selectAllToggle(r)},d=()=>{var r;(r=p.current)==null||r.collapseAll()},n=()=>{v(r=>r==="asc"?"desc":"asc")},i=T.handleSubmit(async r=>{const m=me(r.selectedFields,t);m.create||m.update?await x(m,{onSuccess:()=>{C.success(e("translations.settings.successToast")),l()},onError:j=>{C.error(j.message)}}):l()});return s.jsx(w.Form,{form:T,children:s.jsxs(V,{onSubmit:i,className:"flex flex-1 flex-col overflow-hidden",children:[s.jsxs(w.Body,{className:"p-0",children:[s.jsx("div",{className:"px-6 py-4",children:s.jsx(de,{sortOrder:g,searchQuery:c,onSearchChange:o,viewMode:u,onViewModeChange:h,onSelectAllToggle:a,initialAllSelected:S.length===0,onSortToggle:n,onCollapseAll:d})}),s.jsx(I,{}),s.jsx("div",{className:"bg-ui-bg-component h-full px-6 pb-6 pt-4",children:s.jsx(K,{ref:p,entities:E,onSelectionChange:A,searchQuery:c,viewMode:u,sortOrder:g})})]}),s.jsx(w.Footer,{children:s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx(w.Close,{asChild:!0,children:s.jsx(_,{variant:"secondary",size:"small",children:e("actions.cancel")})}),s.jsx(_,{size:"small",type:"submit",isLoading:b,children:e("actions.save")})]})})]})})},Se=()=>{const{translation_settings:t,isPending:e,isError:l,error:c}=ae();if(l)throw c;return s.jsxs(w,{children:[s.jsx(w.Header,{children:s.jsx(w.Title,{asChild:!0,children:s.jsx(q,{children:"Manage translatable entities"})})}),e?s.jsx(w.Body,{className:"flex h-full items-center justify-center",children:s.jsx(U,{className:"animate-spin"})}):t&&s.jsx(he,{translation_settings:t})]})};export{Se as Component};
